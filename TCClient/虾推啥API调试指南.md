# 虾推啥API调试指南 🔧

## 📋 推送失败问题排查

如果遇到"测试推送发送失败"的问题，请按以下步骤逐一排查：

### 1. 检查Token格式 ✅

**正确的Token应该是什么样的？**
- 从 https://xtuis.cn/ 获取的Token
- 通常是一个字符串，如：`XT123456789`、`abcd1234` 等
- **不要**包含完整的URL，只需要Token部分

**错误示例：**
```
❌ https://xtuis.cn/XT123456789  (包含了完整URL)
❌ xtuis.cn/XT123456789         (包含了域名)
```

**正确示例：**
```
✅ XT123456789                  (只有Token部分)
✅ abcd1234                     (只有Token部分)
```

### 2. 网络连接测试 🌐

**测试步骤：**
1. 打开浏览器访问 https://xtuis.cn/
2. 确认可以正常访问虾推啥网站
3. 检查防火墙是否阻止了应用的网络访问

**常见网络问题：**
- 公司网络可能阻止了外网访问
- 防火墙或杀毒软件阻止了HTTP请求
- 代理设置导致连接失败

### 3. 虾推啥API调用格式 📡

**我们的应用会自动尝试以下几种API格式：**

1. **POST JSON格式**
   ```
   POST https://xtuis.cn/{token}
   Content-Type: application/json
   Body: {"text": "消息内容"}
   ```

2. **GET URL参数格式**
   ```
   GET https://xtuis.cn/{token}?text=消息内容
   ```

3. **POST 表单格式**
   ```
   POST https://xtuis.cn/{token}
   Content-Type: application/x-www-form-urlencoded
   Body: text=消息内容&message=消息内容&content=消息内容
   ```

### 4. 查看详细日志 📝

**如何查看应用日志：**
1. 应用会在运行目录生成日志文件
2. 查找包含"推送"、"xtuis"、"token"关键词的日志
3. 查看HTTP响应状态码和错误信息

**常见日志信息：**
- `POST JSON推送成功` - JSON格式推送成功
- `GET推送成功` - GET格式推送成功
- `POST表单推送成功` - 表单格式推送成功
- `状态码=404` - Token可能不存在
- `状态码=400` - 请求格式可能有误
- `状态码=500` - 服务器内部错误

### 5. 手动测试虾推啥API 🧪

**使用浏览器测试：**
1. 获取你的Token（如：`XT123456789`）
2. 在浏览器中访问：
   ```
   https://xtuis.cn/XT123456789?text=测试消息
   ```
3. 查看返回结果和是否收到推送

**使用curl命令测试：**
```bash
# GET方式
curl "https://xtuis.cn/XT123456789?text=测试消息"

# POST JSON方式
curl -X POST "https://xtuis.cn/XT123456789" \
     -H "Content-Type: application/json" \
     -d '{"text":"测试消息"}'

# POST 表单方式
curl -X POST "https://xtuis.cn/XT123456789" \
     -d "text=测试消息"
```

### 6. 常见错误码对照 ❌

| 状态码 | 含义 | 解决方法 |
|--------|------|----------|
| 200 | 成功 | ✅ 推送正常 |
| 400 | 请求格式错误 | 检查Token格式或消息内容 |
| 404 | Token不存在 | 确认Token是否正确 |
| 429 | 请求过于频繁 | 等待一段时间后重试 |
| 500 | 服务器错误 | 虾推啥服务可能暂时不可用 |

### 7. 推送配置检查 ⚙️

**在应用中检查：**
1. ✅ 是否勾选了"开启推送功能"
2. 📝 Token是否正确添加
3. 🔢 每日推送限制是否合理
4. ⏰ 推送间隔是否设置

### 8. 虾推啥服务状态 📊

**如果所有测试都失败：**
1. 访问 https://xtuis.cn/ 检查服务是否正常
2. 查看虾推啥官方公告
3. 尝试重新生成Token

### 9. 应用内调试功能 🔍

**已实现的调试功能：**
- ✅ 自动尝试多种API格式
- ✅ 详细的网络连接测试
- ✅ 完整的错误日志记录
- ✅ 友好的错误提示信息

**测试推送时的步骤：**
1. 检测网络连接 → 测试能否访问虾推啥
2. 尝试JSON格式 → 如果失败，自动尝试下一种
3. 尝试GET格式 → 如果失败，自动尝试下一种
4. 尝试表单格式 → 如果失败，返回失败信息

### 10. 获取技术支持 🆘

**如果问题仍未解决：**
1. 📋 记录具体的错误信息
2. 🔗 确认Token来源（从哪个页面获取）
3. 🌐 确认网络环境（公司网络/家庭网络）
4. 📱 确认推送接收端设置（微信/QQ等）

## 🎯 推送成功的标志

**如何确认推送成功：**
1. ✅ 应用显示"测试推送发送成功"
2. 📱 推送接收端收到消息
3. 📝 日志显示"推送成功"字样
4. 🔢 推送计数增加

## 📝 测试消息示例

**应用发送的测试消息格式：**
```
📊 市场分析报告 - 2024-01-15 14:30
━━━━━━━━━━━━━━━━━━━━
📈 涨幅分析:
🔥 当天和30天共涨 (2个):
  BTCUSDT: 当天+5.20%, 30天+12.80%
  ETHUSDT: 当天+3.10%, 30天+8.40%
⚡ 仅当天上涨 (1个):
  ADAUSDT: +2.50%
📉 跌幅分析:
❄️ 当天和30天共跌 (1个):
  XRPUSDT: 当天-2.10%, 30天-5.60%
━━━━━━━━━━━━━━━━━━━━
📊 总计: 100 个合约
```

如果你能收到类似这样的消息，说明推送功能工作正常！🎉

---

💡 **小贴士：** 推送功能配置成功后，应用会每4小时（可配置）自动发送市场分析报告，无需人工干预。 