# 成交量监控功能使用说明

## 功能概述

本功能可以自动监控 CoinStats 网站 (https://coinstats.app/zh/exchanges/) 的24小时成交量数据，当成交量触发设定的阈值时，会通过虾推啥推送服务发送预警通知。

## 主要特性

- ✅ **自动抓取**: 每10分钟自动从 CoinStats 网站获取最新的24小时成交量数据
- ✅ **双重预警**: 支持低成交量和高成交量两种预警阈值
- ✅ **智能推送**: 集成虾推啥推送服务，预警信息实时推送到手机
- ✅ **冷却保护**: 防止频繁预警，设有1小时预警冷却时间
- ✅ **界面集成**: 在推送配置窗口中统一管理成交量监控设置
- ✅ **手动刷新**: 支持手动获取当前成交量数据

## 使用步骤

### 1. 配置推送服务

首先需要配置虾推啥推送服务：

1. 打开 "推送配置" 窗口
2. 在 "虾推啥Token管理" 区域添加你的 Token
3. 启用推送功能

### 2. 设置成交量监控

在推送配置窗口中找到 "📈 成交量监控预警" 区域：

1. **启用监控**: 勾选 "开启成交量监控"
2. **设置低成交量预警**: 
   - 输入低成交量阈值（单位：亿美元）
   - 勾选 "启用低成交量预警"
   - 当24小时成交量低于此值时触发预警
3. **设置高成交量预警**:
   - 输入高成交量阈值（单位：亿美元）
   - 勾选 "启用高成交量预警"
   - 当24小时成交量高于此值时触发预警
4. **监控间隔**: 设置数据检查间隔（建议10分钟）

**⚠️ 重要**: 高成交量阈值必须大于低成交量阈值

### 3. 保存配置

点击 "保存配置" 按钮保存设置。

### 4. 启动监控

成交量监控服务会在以下情况下自动启动：
- 推送配置保存后
- 应用程序启动时（如果监控已启用）

## 配置示例

### 推荐配置值

- **低成交量阈值**: 500 亿美元
  - 当市场成交量异常低迷时预警
- **高成交量阈值**: 1000 亿美元
  - 当市场出现异常活跃时预警
- **监控间隔**: 10 分钟
  - 平衡及时性和服务器压力

### 预警消息格式

**低成交量预警**:
```
【成交量跌破预警】

24小时成交量跌破设定阈值

当前成交量: $456,789,012,345
预警阈值: $500,000,000,000
检查时间: 2024-01-15 14:30:25
```

**高成交量预警**:
```
【成交量突破预警】

24小时成交量突破设定阈值

当前成交量: $1,234,567,890,123
预警阈值: $1,000,000,000,000
检查时间: 2024-01-15 14:30:25
```

## 测试功能

### 手动测试

1. 在成交量监控区域点击 "刷新" 按钮
2. 查看当前成交量显示是否正常
3. 检查日志输出确认数据获取成功

### 代码测试

项目包含测试类 `TestVolumeMonitor`，可以测试以下功能：
- 网页抓取功能
- 监控服务功能
- 配置保存和加载

在代码中调用：
```csharp
await TestVolumeMonitor.RunAllTestsAsync();
```

## 技术细节

### 数据来源

- **网站**: https://coinstats.app/zh/exchanges/
- **数据**: 全市场24小时成交量统计
- **更新频率**: 网站实时更新，我们每10分钟获取一次

### 数据解析

使用正则表达式解析网页中的成交量数据：
- 支持 K、M、B、T、Q 等单位后缀
- 自动转换为美元数值
- 智能处理逗号分隔符

### 存储方式

- **推送配置**: 存储在 `push_config.json`
- **监控配置**: 存储在 `volume_monitor_config.json`
- **配置位置**: 应用程序根目录

## 故障排除

### 常见问题

1. **无法获取成交量数据**
   - 检查网络连接
   - 确认 CoinStats 网站可正常访问
   - 查看日志文件获取详细错误信息

2. **预警未触发**
   - 确认监控功能已启用
   - 检查推送服务配置是否正确
   - 验证阈值设置是否合理

3. **推送失败**
   - 检查虾推啥 Token 是否有效
   - 确认推送服务未达到每日限制
   - 查看推送状态显示

### 日志查看

系统会记录详细的运行日志，包括：
- 成交量数据获取结果
- 预警触发情况
- 推送发送状态
- 错误信息和异常

## 注意事项

1. **网络依赖**: 功能需要稳定的网络连接
2. **推送限制**: 受虾推啥服务的推送频率和次数限制
3. **冷却时间**: 预警有1小时冷却时间，避免频繁通知
4. **阈值设置**: 建议根据市场实际情况设置合理的阈值
5. **服务稳定性**: 长期运行建议定期检查服务状态

## 版本更新日志

### v1.0.0
- ✅ 基础成交量监控功能
- ✅ 双重阈值预警系统
- ✅ 推送服务集成
- ✅ 图形化配置界面
- ✅ 配置持久化存储
- ✅ 手动刷新功能
- ✅ 完整的测试套件

---

如有问题或建议，请查看日志文件或联系技术支持。 