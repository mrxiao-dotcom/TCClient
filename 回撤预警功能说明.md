# 回撤预警功能说明

## 功能概述
回撤预警是一个专业的风险管理工具，帮助交易者实时监控持仓的回撤情况，及时发现风险并采取相应措施。

## 界面布局

### 主界面结构
- **上下分屏设计**：上半部分为上涨回撤监控（做多风险），下半部分为下跌回撤监控（做空风险）
- **三列布局**：每个面板都分为监控列表、数据展示、K线图三个区域

### 上涨回撤监控面板（做多风险）
- **标题**：📈 上涨回撤监控（做多风险）
- **背景色**：淡绿色主题 (#E8F5E8)
- **监控对象**：做多持仓的回撤风险

### 下跌回撤监控面板（做空风险）
- **标题**：📉 下跌回撤监控（做空风险）
- **背景色**：淡橙色主题 (#FFF3E0)
- **监控对象**：做空持仓的回撤风险

## 功能特性

### 1. 监控列表管理
- **添加合约**：点击"添加合约"按钮可以添加需要监控的合约
- **删除合约**：选中合约后点击"删除合约"按钮可以移除监控
- **实时更新**：列表中显示合约的24小时成交额和24小时涨幅
- **颜色编码**：涨幅用红色显示，跌幅用绿色显示，平盘用灰色显示

### 2. 数据展示区域
当选中监控列表中的合约时，右侧数据展示区域会显示详细信息：

#### 做多监控数据
- **合约代码**：当前选中的合约名称
- **最近最高价**：从K线数据中找到的最高价格（红色显示）
- **最高价时间**：达到最高价的时间点
- **最大回撤**：历史最大回撤百分比（红色加粗显示）
- **当前回撤**：当前回撤百分比（橙色显示）
- **最大回撤分钟数**：最大回撤持续的时间
- **当前回撤分钟数**：当前回撤持续的时间

#### 做空监控数据
- **合约代码**：当前选中的合约名称
- **最近最低价**：从K线数据中找到的最低价格（绿色显示）
- **最低价时间**：达到最低价的时间点
- **最大回撤**：历史最大回撤百分比（红色加粗显示）
- **当前回撤**：当前回撤百分比（橙色显示）
- **最大回撤分钟数**：最大回撤持续的时间
- **当前回撤分钟数**：当前回撤持续的时间

### 3. K线图显示
- **触发方式**：双击监控列表中的合约
- **显示内容**：4个实时K线图
  - 日线图
  - 1小时线图
  - 15分钟线图
  - 5分钟线图
- **布局**：2×2网格布局，每个图表独立显示

## 数据更新机制

### K线数据更新（每分钟）
- **更新频率**：每60秒执行一次
- **数据获取**：获取100根5分钟K线记录
- **处理逻辑**：
  - 找到最高价和对应的时间（做多）
  - 找到最低价和对应的时间（做空）
  - 计算从极值点开始的回撤数据
  - 保存到本地缓存

### Tick数据更新（每5秒）
- **更新频率**：每5秒执行一次
- **更新内容**：
  - 24小时成交额
  - 24小时涨跌幅
  - 当前价格
  - 实时回撤计算

## 回撤计算逻辑

### 做多回撤计算
```
当前回撤 = (当前价格 - 最近最高价) / 最近最高价 × 100%
```
- 负值表示回撤（价格下跌）
- 回撤越大，风险越高

### 做空回撤计算
```
当前回撤 = (当前价格 - 最近最低价) / 最近最低价 × 100%
```
- 正值表示回撤（价格上涨）
- 回撤越大，风险越高

## 使用方法

### 1. 打开回撤预警
- 在主菜单中选择"统计分析" → "回撤预警"
- 窗口将以非模态方式打开，可以与其他窗口同时使用

### 2. 添加监控合约
- 在上涨回撤监控面板点击"添加合约"按钮添加做多监控
- 在下跌回撤监控面板点击"添加合约"按钮添加做空监控
- 系统会自动开始监控该合约的回撤情况

### 3. 查看详细数据
- 点击监控列表中的合约查看详细回撤数据
- 双击合约可以查看4个周期的K线图

### 4. 删除监控
- 选中不需要监控的合约
- 点击"删除合约"按钮移除监控
- 对应的数据展示区域会自动清空

## 风险提示

### 回撤阈值建议
- **轻度回撤**：0-3%，正常波动范围
- **中度回撤**：3-8%，需要关注
- **重度回撤**：8-15%，高风险警告
- **极度回撤**：>15%，建议立即处理

### 使用注意事项
1. **实时监控**：系统会自动更新数据，无需手动刷新
2. **网络依赖**：需要稳定的网络连接获取实时数据
3. **资源占用**：监控的合约越多，系统资源占用越大
4. **风险管理**：回撤预警仅供参考，不构成投资建议

## 技术特性

### 数据缓存
- 本地缓存K线数据，减少网络请求
- 智能更新机制，只获取必要的数据

### 性能优化
- 异步数据更新，不阻塞界面操作
- 内存管理优化，自动清理过期数据

### 错误处理
- 网络异常自动重试
- 数据异常容错处理
- 详细的错误日志记录

## 示例数据
系统启动时会自动添加示例数据：
- **BTCUSDT**：做多监控示例
- **ETHUSDT**：做空监控示例

这些示例数据可以帮助用户快速了解功能使用方法。 